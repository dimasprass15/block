 1;
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block Blast Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            overflow-x: hidden;
        }

        .game-container {
            width: 100%;
            max-width: min(98vw, 520px);
            height: auto;
            max-height: 98vh;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(20px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.3), 
                        inset 0 1px 0 rgba(255,255,255,0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: containerFloat 6s ease-in-out infinite;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        @keyframes containerFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .game-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px 0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .back-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(238, 90, 36, 0.3);
            display: flex;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(238, 90, 36, 0.4);
            background: linear-gradient(45deg, #ee5a24, #ff6b6b);
        }

        .game-info {
            text-align: center;
            flex: 1;
            min-width: 200px;
        }

        .game-title {
            font-size: clamp(1.2rem, 4vw, 1.6rem);
            font-weight: bold;
            margin-bottom: 6px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGlow 2s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 5px rgba(255, 215, 0, 0.3)); }
            50% { filter: brightness(1.2) drop-shadow(0 0 15px rgba(255, 215, 0, 0.6)); }
        }

        .level-indicator {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            padding: 6px 12px;
            border-radius: 15px;
            display: inline-block;
            margin-bottom: 6px;
            font-size: clamp(0.75rem, 2.5vw, 0.85rem);
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            animation: levelPulse 3s ease-in-out infinite;
        }

        @keyframes levelPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .score-display {
            font-size: clamp(1rem, 3vw, 1.2rem);
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
            animation: scoreShine 4s ease-in-out infinite;
        }

        @keyframes scoreShine {
            0%, 100% { box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); }
            50% { box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6), 0 0 20px rgba(255, 255, 255, 0.3); }
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: clamp(5px, 1.2vw, 10px);
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.2));
            padding: clamp(22px, 6vw, 32px);
            border-radius: 18px;
            margin-bottom: 18px;
            aspect-ratio: 1;
            box-shadow: inset 0 4px 15px rgba(0, 0, 0, 0.3),
                        0 4px 20px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            max-width: min(98vw, 480px);
            margin-left: auto;
            margin-right: auto;
        }

        .grid-cell {
            aspect-ratio: 1;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: clamp(7px, 1.8vw, 14px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            min-height: 0;
            font-size: clamp(14px, 3.5vw, 20px);
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        .grid-cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .grid-cell:hover::before {
            left: 100%;
        }

        .grid-cell.filled {
            background: var(--cell-color, #4CAF50);
            box-shadow: inset 0 0 15px rgba(255, 255, 255, 0.3),
                        0 4px 15px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transform: scale(1.02);
            animation: cellPop 0.3s ease-out;
        }

        @keyframes cellPop {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1.02); opacity: 1; }
        }

        .grid-cell.preview {
            background: var(--preview-color, rgba(76, 175, 80, 0.6));
            border: 3px solid #4CAF50;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
            animation: previewPulse 0.5s ease-in-out infinite;
        }

        @keyframes previewPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 0.9; }
        }

        .grid-cell.invalid {
            background: rgba(244, 67, 54, 0.6);
            border: 3px solid #f44336;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(244, 67, 54, 0.5);
            animation: invalidShake 0.5s ease-in-out;
        }

        @keyframes invalidShake {
            0%, 100% { transform: translateX(0) scale(1.05); }
            25% { transform: translateX(-3px) scale(1.05); }
            75% { transform: translateX(3px) scale(1.05); }
        }

        .pieces-container {
            display: flex;
            justify-content: space-between;
            gap: clamp(8px, 2vw, 12px);
            margin-bottom: 15px;
            width: 100%;
        }

        .piece-holder {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            border-radius: 18px;
            padding: clamp(25px, 6vw, 35px);
            min-height: clamp(140px, 28vw, 180px);
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            cursor: grab;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            max-width: 180px;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        .piece-holder::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .piece-holder:hover::before {
            transform: translateX(100%);
        }

        .piece-holder:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15));
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .piece-holder.dragging {
            opacity: 0.7;
            transform: scale(0.95) rotate(3deg);
            cursor: grabbing;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            animation: draggingFloat 0.5s ease-in-out infinite;
        }

        @keyframes draggingFloat {
            0%, 100% { transform: scale(0.95) rotate(3deg) translateY(0px); }
            50% { transform: scale(0.95) rotate(3deg) translateY(-3px); }
        }

        .piece-holder.empty {
            opacity: 0.4;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border-style: dashed;
            animation: emptyBreathe 3s ease-in-out infinite;
        }

        @keyframes emptyBreathe {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.2; }
        }

        .piece {
            display: grid;
            gap: 4px;
            animation: pieceAppear 0.5s ease-out;
        }

        @keyframes pieceAppear {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .piece-block {
            width: clamp(32px, 7vw, 42px);
            height: clamp(32px, 7vw, 42px);
            background: var(--block-color, #4CAF50);
            border-radius: clamp(6px, 1.5vw, 12px);
            box-shadow: inset 0 0 8px rgba(255, 255, 255, 0.4),
                        0 4px 10px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-size: clamp(14px, 3.5vw, 20px);
        }

        .piece-block::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            animation: blockShine 2s linear infinite;
        }

        @keyframes blockShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .clear-animation {
            animation: clearLineEnhanced 1.2s ease-in-out;
            position: relative;
            z-index: 10;
        }

        @keyframes clearLineEnhanced {
            0% { 
                background: var(--cell-color, #4CAF50); 
                transform: scale(1.02);
                filter: brightness(1);
            }
            15% { 
                background: #FFD700; 
                transform: scale(1.25);
                box-shadow: 0 0 40px rgba(255, 215, 0, 1), 
                           0 0 80px rgba(255, 215, 0, 0.6),
                           inset 0 0 20px rgba(255, 255, 255, 0.8);
                filter: brightness(1.5) saturate(1.5);
            }
            30% { 
                background: #FF6B6B; 
                transform: scale(1.35) rotate(5deg);
                box-shadow: 0 0 50px rgba(255, 107, 107, 1),
                           0 0 100px rgba(255, 107, 107, 0.6),
                           inset 0 0 25px rgba(255, 255, 255, 0.9);
                filter: brightness(1.8) saturate(2);
            }
            45% { 
                background: #4ECDC4; 
                transform: scale(1.3) rotate(-3deg);
                box-shadow: 0 0 45px rgba(78, 205, 196, 1),
                           0 0 90px rgba(78, 205, 196, 0.6),
                           inset 0 0 22px rgba(255, 255, 255, 0.8);
                filter: brightness(1.6) saturate(1.8);
            }
            60% { 
                background: #9B59B6; 
                transform: scale(1.25) rotate(2deg);
                box-shadow: 0 0 40px rgba(155, 89, 182, 1),
                           0 0 80px rgba(155, 89, 182, 0.6),
                           inset 0 0 20px rgba(255, 255, 255, 0.7);
                filter: brightness(1.4) saturate(1.6);
            }
            75% { 
                background: #E67E22; 
                transform: scale(1.15);
                box-shadow: 0 0 35px rgba(230, 126, 34, 0.8),
                           0 0 70px rgba(230, 126, 34, 0.4);
                filter: brightness(1.2) saturate(1.4);
            }
            90% { 
                background: rgba(255, 255, 255, 0.8); 
                transform: scale(1.05);
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
                filter: brightness(2) saturate(0);
            }
            100% { 
                background: rgba(255, 255, 255, 0.1); 
                transform: scale(1);
                box-shadow: none;
                filter: brightness(1) saturate(1);
            }
        }

        .combo-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            pointer-events: none;
            font-size: 3rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            animation: comboAnimation 2s ease-out forwards;
        }

        @keyframes comboAnimation {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5) rotate(-10deg);
                filter: blur(5px);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.5) rotate(5deg);
                filter: blur(0px);
                text-shadow: 3px 3px 6px rgba(0,0,0,0.8), 
                           0 0 30px rgba(255, 215, 0, 0.8),
                           0 0 60px rgba(255, 215, 0, 0.4);
            }
            40% {
                transform: translate(-50%, -50%) scale(1.2) rotate(-2deg);
                text-shadow: 3px 3px 6px rgba(0,0,0,0.8), 
                           0 0 40px rgba(255, 215, 0, 1),
                           0 0 80px rgba(255, 215, 0, 0.6);
            }
            60% {
                transform: translate(-50%, -50%) scale(1.3) rotate(1deg);
                color: #FF6B6B;
                text-shadow: 3px 3px 6px rgba(0,0,0,0.8), 
                           0 0 35px rgba(255, 107, 107, 1),
                           0 0 70px rgba(255, 107, 107, 0.6);
            }
            80% {
                transform: translate(-50%, -50%) scale(1.1) rotate(0deg);
                color: #4ECDC4;
                text-shadow: 3px 3px 6px rgba(0,0,0,0.8), 
                           0 0 30px rgba(78, 205, 196, 1),
                           0 0 60px rgba(78, 205, 196, 0.6);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8) translateY(-100px);
                filter: blur(3px);
            }
        }

        .particle-effect {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #FFD700;
            border-radius: 50%;
            pointer-events: none;
            z-index: 15;
            animation: particleFloat 1.5s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: scale(1) rotate(0deg) translate(0, 0);
                box-shadow: 0 0 10px currentColor;
            }
            50% {
                opacity: 0.8;
                transform: scale(1.5) rotate(180deg) translate(var(--particle-x, 30px), var(--particle-y, -40px));
                box-shadow: 0 0 20px currentColor;
            }
            100% {
                opacity: 0;
                transform: scale(0.5) rotate(360deg) translate(var(--particle-x, 50px), var(--particle-y, -80px));
                box-shadow: 0 0 5px currentColor;
            }
        }

        .screen-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.3) 0%, rgba(255, 215, 0, 0.1) 50%, transparent 100%);
            pointer-events: none;
            z-index: 500;
            opacity: 0;
            animation: screenFlash 0.8s ease-out;
        }

        @keyframes screenFlash {
            0% { opacity: 0; }
            30% { opacity: 1; }
            100% { opacity: 0; }
        }

        .line-clear-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            pointer-events: none;
            z-index: 20;
            animation: lineClearText 1.2s ease-out forwards;
        }

        @keyframes lineClearText {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            30% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }
            70% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8) translateY(-30px);
            }
        }

        .reading-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            backdrop-filter: blur(15px);
        }

        .reading-popup-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            max-width: 380px;
            width: 90%;
            box-shadow: 0 25px 60px rgba(0,0,0,0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
            animation: popupSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes popupSlideIn {
            0% {
                opacity: 0;
                transform: scale(0.7) translateY(-50px) rotate(-5deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0) rotate(0deg);
            }
        }

        .reading-popup h2 {
            margin-bottom: 25px;
            font-size: 1.6rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hijaiyah-letter {
            font-size: 5rem;
            font-weight: bold;
            margin: 25px 0;
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 20px;
            padding: 20px;
            border: 3px solid rgba(255, 215, 0, 0.3);
            animation: letterGlow 2s ease-in-out infinite;
        }

        @keyframes letterGlow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
                transform: scale(1.05);
            }
        }



        .continue-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        .continue-btn:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(76, 175, 80, 0.6);
        }

        .evaluation-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            backdrop-filter: blur(15px);
        }

        .evaluation-content {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 35px;
            border-radius: 25px;
            text-align: center;
            max-width: 420px;
            width: 90%;
            box-shadow: 0 25px 60px rgba(0,0,0,0.5);
            border: 2px solid rgba(255, 255, 255, 0.2);
            animation: popupSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .evaluation-header {
            margin-bottom: 30px;
        }

        .evaluation-progress {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 12px;
            margin-bottom: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .evaluation-letters {
            font-size: 3.5rem;
            font-weight: bold;
            margin: 30px 0;
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            border: 3px solid rgba(255, 215, 0, 0.3);
            animation: letterGlow 2s ease-in-out infinite;
        }

        .evaluation-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 30px 0;
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .option-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .option-btn.correct {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border-color: #2ecc71;
            animation: correctPulse 0.6s ease-in-out;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .option-btn.wrong {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border-color: #c0392b;
            animation: wrongShake 0.6s ease-in-out;
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .evaluation-result {
            margin-top: 25px;
            font-size: 1.3rem;
            font-weight: bold;
            padding: 15px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .level-complete {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1003;
            backdrop-filter: blur(15px);
        }

        .level-complete-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 45px;
            border-radius: 25px;
            text-align: center;
            max-width: 420px;
            width: 90%;
            box-shadow: 0 25px 60px rgba(0,0,0,0.5);
            border: 2px solid rgba(255, 255, 255, 0.2);
            animation: popupSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Welcome Screen Styles */
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: clamp(10px, 3vw, 20px);
            overflow-y: auto;
        }

        .welcome-container {
            max-width: min(95vw, 450px);
            width: 100%;
            text-align: center;
            color: white;
            animation: slideInUp 1s ease-out;
            max-height: 95vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: fit-content;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-header {
            margin-bottom: clamp(20px, 5vw, 40px);
            flex-shrink: 0;
        }

        .game-logo {
            margin-bottom: clamp(15px, 4vw, 30px);
        }

        .logo-blocks {
            display: flex;
            justify-content: center;
            gap: clamp(6px, 2vw, 12px);
            margin-bottom: clamp(15px, 4vw, 25px);
            flex-wrap: wrap;
        }

        .logo-block {
            width: clamp(40px, 10vw, 60px);
            height: clamp(40px, 10vw, 60px);
            background: rgba(255, 255, 255, 0.2);
            border-radius: clamp(8px, 2vw, 15px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.2rem, 4vw, 2rem);
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: logoFloat 3s ease-in-out infinite;
            flex-shrink: 0;
        }

        .logo-block.block-1 { animation-delay: 0s; }
        .logo-block.block-2 { animation-delay: 0.2s; }
        .logo-block.block-3 { animation-delay: 0.4s; }
        .logo-block.block-4 { animation-delay: 0.6s; }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .welcome-title {
            font-size: clamp(1.5rem, 6vw, 2.8rem);
            font-weight: bold;
            margin-bottom: clamp(8px, 2vw, 15px);
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShine 2s ease-in-out infinite;
            line-height: 1.2;
        }

        @keyframes titleShine {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .welcome-subtitle {
            font-size: clamp(0.9rem, 3vw, 1.2rem);
            opacity: 0.9;
            margin-bottom: 0;
            line-height: 1.3;
        }

        .welcome-features {
            display: grid;
            grid-template-columns: 1fr;
            gap: clamp(12px, 3vw, 20px);
            margin-bottom: clamp(20px, 5vw, 40px);
            flex-shrink: 0;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: clamp(12px, 3vw, 20px);
            padding: clamp(15px, 4vw, 25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            animation: cardSlideIn 1s ease-out;
        }

        .feature-card:nth-child(1) { animation-delay: 0.2s; }
        .feature-card:nth-child(2) { animation-delay: 0.4s; }
        .feature-card:nth-child(3) { animation-delay: 0.6s; }

        @keyframes cardSlideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .feature-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .feature-icon {
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            margin-bottom: clamp(10px, 3vw, 18px);
            display: block;
        }

        .feature-card h3 {
            font-size: clamp(1rem, 3.5vw, 1.4rem);
            margin-bottom: clamp(8px, 2vw, 12px);
            color: #FFD700;
            line-height: 1.2;
        }

        .feature-card p {
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            opacity: 0.9;
            line-height: 1.4;
            margin: 0;
        }

        .welcome-actions {
            display: flex;
            flex-direction: column;
            gap: clamp(10px, 3vw, 18px);
            margin-bottom: clamp(15px, 4vw, 30px);
            flex-shrink: 0;
        }

        .start-btn, .info-btn {
            padding: clamp(12px, 3vw, 20px) clamp(20px, 5vw, 35px);
            border: none;
            border-radius: clamp(15px, 4vw, 30px);
            font-size: clamp(1rem, 3vw, 1.3rem);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(8px, 2vw, 12px);
            text-decoration: none;
            animation: buttonPulse 2s ease-in-out infinite;
            min-height: clamp(45px, 8vw, 60px);
        }

        .start-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(76, 175, 80, 0.6);
            background: linear-gradient(45deg, #45a049, #4CAF50);
        }

        .info-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .info-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        @keyframes buttonPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes tempUnlockPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            }
        }

        .btn-icon {
            font-size: clamp(1rem, 3vw, 1.4rem);
            flex-shrink: 0;
        }

        .welcome-footer {
            opacity: 0.8;
            font-style: italic;
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            line-height: 1.3;
            flex-shrink: 0;
        }

        /* Instructions Modal */
        .instructions-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            backdrop-filter: blur(5px);
        }

        .instructions-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 25px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: modalSlideIn 0.4s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .instructions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .instructions-header h2 {
            margin: 0;
            font-size: 1.8rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .instructions-body {
            margin-bottom: 25px;
        }

        .instruction-step {
            display: flex;
            align-items: flex-start;
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .instruction-step:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .step-number {
            background: #FFD700;
            color: #333;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .step-content h4 {
            margin: 0 0 8px 0;
            font-size: 1.2rem;
            color: #FFD700;
        }

        .step-content p {
            margin: 0;
            opacity: 0.9;
            line-height: 1.4;
        }

        /* Level Map Screen Styles */
        .level-map-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 999;
            padding: clamp(10px, 3vw, 20px);
            overflow-y: auto;
        }

        .level-map-container {
            max-width: min(95vw, 500px);
            width: 100%;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            padding: clamp(15px, 4vw, 25px);
            backdrop-filter: blur(20px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: mapSlideIn 0.8s ease-out;
            max-height: 95vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        @keyframes mapSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(30px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .level-map-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: clamp(20px, 5vw, 30px);
            flex-wrap: wrap;
            gap: 15px;
        }

        .map-title {
            text-align: center;
            color: white;
            flex: 1;
            min-width: 200px;
        }

        .map-title h1 {
            font-size: clamp(1.3rem, 4vw, 1.8rem);
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .map-title p {
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            opacity: 0.9;
            margin: 0;
        }

        .level-map-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: clamp(20px, 5vw, 30px);
        }

        .level-path {
            display: flex;
            flex-direction: column;
            gap: clamp(8px, 2vw, 15px);
            position: relative;
        }

        .level-node {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: clamp(15px, 4vw, 20px);
            display: flex;
            align-items: center;
            gap: clamp(12px, 3vw, 18px);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            position: relative;
            color: white;
        }

        .level-node.available {
            background: rgba(76, 175, 80, 0.3);
            border-color: rgba(76, 175, 80, 0.6);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.2);
        }

        .level-node.available:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(76, 175, 80, 0.3);
            background: rgba(76, 175, 80, 0.4);
        }

        .level-node.locked {
            background: rgba(128, 128, 128, 0.2);
            border-color: rgba(128, 128, 128, 0.4);
            opacity: 0.6;
            cursor: pointer;
        }
        
        .level-node.locked:hover {
            background: rgba(128, 128, 128, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(128, 128, 128, 0.2);
        }

        .level-node.completed {
            background: rgba(255, 215, 0, 0.3);
            border-color: rgba(255, 215, 0, 0.6);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
        }

        .level-node.selected {
            background: rgba(102, 126, 234, 0.4);
            border-color: rgba(102, 126, 234, 0.8);
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.4);
            transform: scale(1.02);
        }

        .level-icon {
            font-size: clamp(2rem, 6vw, 3rem);
            width: clamp(50px, 12vw, 70px);
            height: clamp(50px, 12vw, 70px);
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            flex-shrink: 0;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .level-info {
            flex: 1;
            min-width: 0;
        }

        .level-info h3 {
            font-size: clamp(1.1rem, 3vw, 1.4rem);
            margin: 0 0 clamp(4px, 1vw, 8px) 0;
            color: #FFD700;
            font-weight: bold;
        }

        .level-info p {
            font-size: clamp(0.85rem, 2.5vw, 1rem);
            margin: 0 0 clamp(6px, 1.5vw, 10px) 0;
            opacity: 0.9;
        }

        .level-progress {
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            background: rgba(255, 255, 255, 0.2);
            padding: clamp(4px, 1vw, 8px) clamp(8px, 2vw, 12px);
            border-radius: 15px;
            display: inline-block;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .level-status {
            font-size: clamp(1.5rem, 4vw, 2rem);
            width: clamp(40px, 8vw, 50px);
            height: clamp(40px, 8vw, 50px);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .level-status.completed {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid rgba(76, 175, 80, 0.6);
        }

        .level-status.locked {
            background: rgba(128, 128, 128, 0.2);
            border: 2px solid rgba(128, 128, 128, 0.4);
        }

        .path-connector {
            width: 4px;
            height: clamp(15px, 3vw, 25px);
            background: linear-gradient(to bottom, rgba(76, 175, 80, 0.6), rgba(76, 175, 80, 0.3));
            margin: 0 auto;
            border-radius: 2px;
            position: relative;
        }

        .path-connector.locked {
            background: linear-gradient(to bottom, rgba(128, 128, 128, 0.4), rgba(128, 128, 128, 0.2));
        }

        .path-connector::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .player-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: clamp(10px, 3vw, 15px);
            margin-top: clamp(15px, 4vw, 25px);
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: clamp(12px, 3vw, 18px);
            display: flex;
            align-items: center;
            gap: clamp(10px, 2vw, 15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            color: white;
        }

        .stat-icon {
            font-size: clamp(1.5rem, 4vw, 2rem);
            width: clamp(35px, 8vw, 45px);
            height: clamp(35px, 8vw, 45px);
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            flex-shrink: 0;
        }

        .stat-info h4 {
            font-size: clamp(0.8rem, 2.2vw, 0.95rem);
            margin: 0 0 clamp(2px, 0.5vw, 4px) 0;
            opacity: 0.9;
        }

        .stat-info p {
            font-size: clamp(1rem, 2.8vw, 1.2rem);
            margin: 0;
            font-weight: bold;
            color: #FFD700;
        }

        .level-map-footer {
            margin-top: clamp(20px, 5vw, 30px);
            display: flex;
            justify-content: center;
            flex-shrink: 0;
        }

        .level-map-footer .start-btn {
            width: 100%;
            max-width: 300px;
            padding: clamp(12px, 3vw, 18px) clamp(20px, 5vw, 30px);
            font-size: clamp(1rem, 3vw, 1.2rem);
            min-height: clamp(45px, 8vw, 55px);
        }

        .level-map-footer .start-btn:disabled {
            background: rgba(128, 128, 128, 0.3);
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Responsive optimizations */
        @media (max-width: 480px) {
            .level-map-header {
                flex-direction: column;
                text-align: center;
            }
            
            .back-btn {
                align-self: flex-start;
            }
            
            .level-node {
                flex-direction: column;
                text-align: center;
                gap: 12px;
            }
            
            .level-info {
                order: -1;
            }
            
            .level-status {
                position: absolute;
                top: 10px;
                right: 10px;
                width: 30px;
                height: 30px;
                font-size: 1.2rem;
            }
            
            .player-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-container">
            <div class="welcome-header">
                <div class="game-logo">
                    <div class="logo-blocks">
                        <div class="logo-block block-1">ÿ®</div>
                        <div class="logo-block block-2">ŸÑ</div>
                        <div class="logo-block block-3">Ÿà</div>
                        <div class="logo-block block-4">ŸÉ</div>
                    </div>
                    <h1 class="welcome-title">Block Blast Hijaiyah</h1>
                    <p class="welcome-subtitle">üïå Belajar Huruf Arab Sambil Bermain üéÆ</p>
                </div>
            </div>

            <div class="welcome-features">
                <div class="feature-card">
                    <div class="feature-icon">üìö</div>
                    <h3>29 Huruf Hijaiyah</h3>
                    <p>Pelajari semua huruf Arab dari Alif sampai Ya</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <h3>Gameplay Seru</h3>
                    <p>Susun blok, bersihkan baris, dan belajar huruf</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üèÜ</div>
                    <h3>Evaluasi & Level</h3>
                    <p>Uji kemampuan dengan kuis interaktif</p>
                </div>
            </div>

            <div class="welcome-actions">
                <button class="start-btn" onclick="startGame()">
                    <span class="btn-icon">üöÄ</span>
                    Mulai Bermain
                </button>
                <button class="info-btn" onclick="showInstructions()">
                    <span class="btn-icon">‚ùì</span>
                    Cara Bermain
                </button>
                <button class="info-btn" onclick="resetProgress()" id="resetBtn" style="display: none;">
                    <span class="btn-icon">üîÑ</span>
                    Reset Progress
                </button>
            </div>

            <div class="welcome-footer">
                <p>‚ú® Belajar Hijaiyah Jadi Lebih Menyenangkan! ‚ú®</p>
            </div>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div class="instructions-modal" id="instructionsModal">
        <div class="instructions-content">
            <div class="instructions-header">
                <h2>üìñ Cara Bermain</h2>
                <button class="close-btn" onclick="closeInstructions()">√ó</button>
            </div>
            <div class="instructions-body">
                <div class="instruction-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Drag & Drop Blok</h4>
                        <p>Seret piece ke grid untuk mengisi baris atau kolom</p>
                    </div>
                </div>
                <div class="instruction-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Bersihkan Baris/Kolom</h4>
                        <p>Isi penuh 1 baris atau kolom untuk menghapusnya</p>
                    </div>
                </div>
                <div class="instruction-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Belajar Hijaiyah</h4>
                        <p>Setiap 3 baris terhapus = belajar 1 huruf Arab baru!</p>
                    </div>
                </div>
                <div class="instruction-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>Evaluasi Level</h4>
                        <p>Selesaikan 29 huruf, lalu ikuti kuis untuk naik level</p>
                    </div>
                </div>
                <div class="instruction-step">
                    <div class="step-number">üîë</div>
                    <div class="step-content">
                        <h4>Password Unlock (Opsional)</h4>
                        <p>Klik level terkunci ‚Üí Pilih "Ya" ‚Üí Masukkan password:<br>
                        Level 2: <strong>hijaiyah2</strong><br>
                        Level 3: <strong>hijaiyah3</strong><br>
                        Level 4: <strong>hijaiyah4</strong><br>
                        Level 5: <strong>hijaiyah5</strong></p>
                    </div>
                </div>
            </div>
            <button class="start-btn" onclick="closeInstructions(); startGame();">
                Siap Bermain! üéÆ
            </button>
        </div>
    </div>

    <!-- Level Map Screen -->
    <div class="level-map-screen" id="levelMapScreen">
        <div class="level-map-container">
            <div class="level-map-header">
                <button class="back-btn" onclick="backToWelcomeFromMap()">
                    <span>‚Üê</span> Menu
                </button>
                <div class="map-title">
                    <h1>üó∫Ô∏è Peta Perjalanan Hijaiyah</h1>
                    <p>Pilih level untuk memulai petualangan belajar!</p>
                </div>
            </div>

            <div class="level-map-content">
                <div class="level-path">
                    <!-- Level 1: Basic Hijaiyah -->
                    <div class="level-node level-1 available" onclick="selectLevel(1)">
                        <div class="level-icon">üìö</div>
                        <div class="level-info">
                            <h3>Level 1</h3>
                            <p>Huruf Dasar</p>
                            <div class="level-progress">
                                <span id="level1Progress">0/28</span> huruf ‚Ä¢ Evaluasi setiap 5 huruf
                            </div>
                        </div>
                        <div class="level-status" id="level1Status">
                            <span>‚ñ∂Ô∏è</span>
                        </div>
                    </div>

                    <!-- Connector -->
                    <div class="path-connector locked" id="connector1"></div>

                    <!-- Level 2: Harakat -->
                    <div class="level-node level-2 locked" onclick="handleLevelClick(2);" id="level2Node" style="cursor: pointer;">
                        <div class="level-icon">üéØ</div>
                        <div class="level-info">
                            <h3>Level 2</h3>
                            <p>Harakat & Tanda Baca</p>
                            <div class="level-progress">
                                <span>0/15</span> harakat
                            </div>
                        </div>
                        <div class="level-status locked" id="level2Status">
                            <span>üîí</span>
                        </div>
                    </div>

                    <!-- Connector -->
                    <div class="path-connector locked" id="connector2"></div>

                    <!-- Level 3: Words -->
                    <div class="level-node level-3 locked" onclick="handleLevelClick(3);" id="level3Node" style="cursor: pointer;">
                        <div class="level-icon">üìñ</div>
                        <div class="level-info">
                            <h3>Level 3</h3>
                            <p>Kata Sederhana</p>
                            <div class="level-progress">
                                <span>0/20</span> kata
                            </div>
                        </div>
                        <div class="level-status locked" id="level3Status">
                            <span>üîí</span>
                        </div>
                    </div>

                    <!-- Connector -->
                    <div class="path-connector locked" id="connector3"></div>

                    <!-- Level 4: Sentences -->
                    <div class="level-node level-4 locked" onclick="handleLevelClick(4);" id="level4Node" style="cursor: pointer;">
                        <div class="level-icon">üïå</div>
                        <div class="level-info">
                            <h3>Level 4</h3>
                            <p>Kalimat Pendek</p>
                            <div class="level-progress">
                                <span>0/10</span> kalimat
                            </div>
                        </div>
                        <div class="level-status locked" id="level4Status">
                            <span>üîí</span>
                        </div>
                    </div>

                    <!-- Connector -->
                    <div class="path-connector locked" id="connector4"></div>

                    <!-- Level 5: Master -->
                    <div class="level-node level-5 locked" onclick="handleLevelClick(5);" id="level5Node" style="cursor: pointer;">
                        <div class="level-icon">üëë</div>
                        <div class="level-info">
                            <h3>Level 5</h3>
                            <p>Master Hijaiyah</p>
                            <div class="level-progress">
                                <span>0/1</span> ujian
                            </div>
                        </div>
                        <div class="level-status locked" id="level5Status">
                            <span>üîí</span>
                        </div>
                    </div>
                </div>

                <!-- Player Stats -->
                <div class="player-stats">
                    <div class="stat-card">
                        <div class="stat-icon">üèÜ</div>
                        <div class="stat-info">
                            <h4>Total Skor</h4>
                            <p id="totalScore">0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìö</div>
                        <div class="stat-info">
                            <h4>Huruf Dipelajari</h4>
                            <p id="totalLetters">0/28</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚≠ê</div>
                        <div class="stat-info">
                            <h4>Level Aktif</h4>
                            <p id="activeLevel">1</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="level-map-footer">
                <button class="start-btn" id="startSelectedLevel" onclick="startSelectedLevel()">
                    <span class="btn-icon">üöÄ</span>
                    Mulai Level 1
                </button>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div class="game-container" id="gameContainer" style="display: none;">
        <div class="game-header">
            <button class="back-btn" onclick="backToLevelMap()">
                <span>‚Üê</span> Peta
            </button>
            <div class="game-info">
                <h1 class="game-title">üéÆ Block Blast</h1>
                <div class="level-indicator">Level <span id="currentLevel">1</span></div>
                <div class="score-display">Skor: <span id="score">0</span></div>
            </div>
        </div>

        <div class="game-content">
            <div class="game-grid" id="gameGrid"></div>

            <div class="pieces-container" id="piecesContainer">
                <div class="piece-holder" data-piece="0"></div>
                <div class="piece-holder" data-piece="1"></div>
                <div class="piece-holder" data-piece="2"></div>
            </div>
        </div>
    </div>

    <!-- Popups -->
    <div class="reading-popup" id="readingPopup">
        <div class="reading-popup-content">
            <h2>üéâ Belajar dulu ya sebelum lanjut main</h2>
            <div class="hijaiyah-letter" id="currentLetter">ÿ£Ÿé</div>
            <p>üë®‚Äçüè´ Ikuti bacaan ustadz!</p>
            <button class="continue-btn" onclick="continueReading()">Lanjutkan</button>
        </div>
    </div>

    <div class="evaluation-popup" id="evaluationPopup">
        <div class="evaluation-content">
            <div class="evaluation-header">
                <h2>üìù Evaluasi Level 1</h2>
                <div class="evaluation-progress">
                    Soal <span id="questionNumber">1</span> dari 10
                </div>
            </div>
            <p>Pilih huruf yang sama:</p>
            <div class="evaluation-letters" id="evaluationLetters">ÿ£Ÿé</div>
            <div class="evaluation-options" id="evaluationOptions">
                <!-- Options will be generated dynamically -->
            </div>
            <div class="evaluation-result" id="evaluationResult"></div>
        </div>
    </div>

    <div class="level-complete" id="levelComplete">
        <div class="level-complete-content">
            <h2>üéâ Selamat!</h2>
            <p>Anda telah menyelesaikan <strong>Level 1</strong>!</p>
            <div style="margin: 20px 0;">
                <p>Skor Evaluasi: <span id="evaluationScore">0</span>/6</p>
            </div>
            <p>Siap untuk melanjutkan ke Level 2?</p>
            <button class="continue-btn" onclick="completeLevel1()">Kembali ke Peta Level</button>
        </div>
    </div>

    <script>
        class BlockBlastGame {
            constructor() {
                this.gridSize = 8;
                this.grid = Array(this.gridSize).fill().map(() => Array(this.gridSize).fill(0));
                this.gridLetters = Array(this.gridSize).fill().map(() => Array(this.gridSize).fill(''));
                this.gridColors = Array(this.gridSize).fill().map(() => Array(this.gridSize).fill(''));
                this.score = 0;
                this.draggedPieceIndex = undefined;
                this.currentPieces = [];
                this.lineClearCount = 0;
                this.currentHijaiyahIndex = 0;
                this.currentLevel = 1;
                this.evaluationQuestions = [];
                this.currentQuestionIndex = 0;
                this.evaluationScore = 0;
                this.isInEvaluation = false;
                
                // Initialize sound effects
                this.initSounds();
                
                // Load saved progress
                this.loadProgress();
                
                // Arabic Hijaiyah letters with harakat
                this.arabicLetters = [
                    'ÿ£Ÿé', 'ÿ®Ÿê', 'ÿ™Ÿè', 'ÿ´Ÿé', 'ÿ¨Ÿê', 'ÿ≠Ÿè', 'ÿÆŸé', 'ÿØŸê', 'ÿ∞Ÿè', 'ÿ±Ÿé',
                    'ÿ≤Ÿê', 'ÿ≥Ÿè', 'ÿ¥Ÿé', 'ÿµŸê', 'ÿ∂Ÿè', 'ÿ∑Ÿé', 'ÿ∏Ÿê', 'ÿπŸè', 'ÿ∫Ÿé', 'ŸÅŸê',
                    'ŸÇŸè', 'ŸÉŸé', 'ŸÑŸê', 'ŸÖŸè', 'ŸÜŸé', 'ŸáŸê', 'ŸàŸè', 'ŸäŸé'
                ];

                // Hijaiyah letters for reading practice (Level 1: Extended sequence)
                this.hijaiyahSequence = [
                    { letter: 'ÿ£Ÿé', name: 'Alif Fathah' },
                    { letter: 'ÿ®Ÿé', name: 'Ba Fathah' },
                    { letter: 'ÿ™Ÿé', name: 'Ta Fathah' },
                    { letter: 'ÿ´Ÿé', name: 'Tsa Fathah' },
                    { letter: 'ÿ¨Ÿé', name: 'Jim Fathah' },
                    { letter: 'ÿ≠Ÿé', name: 'Ha Fathah' },
                    { letter: 'ÿÆŸé', name: 'Kho Fathah' },
                    { letter: 'ÿØŸé', name: 'Dal Fathah' },
                    { letter: 'ÿ∞Ÿé', name: 'Dzal Fathah' },
                    { letter: 'ÿ±Ÿé', name: 'Ra Fathah' },
                    { letter: 'ÿ≤Ÿé', name: 'Zai Fathah' },
                    { letter: 'ÿ≥Ÿé', name: 'Sin Fathah' },
                    { letter: 'ÿ¥Ÿé', name: 'Syin Fathah' },
                    { letter: 'ÿµŸé', name: 'Shod Fathah' },
                    { letter: 'ÿ∂Ÿé', name: 'Dhod Fathah' },
                    { letter: 'ÿ∑Ÿé', name: 'Tho Fathah' },
                    { letter: 'ÿ∏Ÿé', name: 'Dzo Fathah' },
                    { letter: 'ÿπŸé', name: 'Ain Fathah' },
                    { letter: 'ÿ∫Ÿé', name: 'Ghoin Fathah' },
                    { letter: 'ŸÅŸé', name: 'Fa Fathah' },
                    { letter: 'ŸÇŸé', name: 'Qof Fathah' },
                    { letter: 'ŸÉŸé', name: 'Kaf Fathah' },
                    { letter: 'ŸÑŸé', name: 'Lam Fathah' },
                    { letter: 'ŸÖŸé', name: 'Mim Fathah' },
                    { letter: 'ŸÜŸé', name: 'Nun Fathah' },
                    { letter: 'ŸáŸé', name: 'Ha Fathah' },
                    { letter: 'ŸàŸé', name: 'Waw Fathah' },
                    { letter: 'ŸäŸé', name: 'Ya Fathah' }
                ];
                
                this.blockColors = [
                    '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
                    '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9',
                    '#F8C471', '#82E0AA', '#F1948A', '#85C1E9', '#F9E79F',
                    '#D7BDE2', '#A3E4D7', '#FAD7A0', '#D5A6BD', '#AED6F1',
                    '#F6DDCC', '#E8DAEF', '#D1F2EB', '#FCF3CF', '#FADBD8',
                    '#EBF5FB', '#FEF9E7', '#EAEDED'
                ];

                this.pieceShapes = [
                    // Single block
                    [[1]],
                    // 2x1 horizontal
                    [[1, 1]],
                    // 2x1 vertical
                    [[1], [1]],
                    // 3x1 horizontal
                    [[1, 1, 1]],
                    // 3x1 vertical
                    [[1], [1], [1]],
                    // L-shape
                    [[1, 0], [1, 1]],
                    // Reverse L-shape
                    [[0, 1], [1, 1]],
                    // 2x2 square
                    [[1, 1], [1, 1]],
                    // T-shape
                    [[1, 1, 1], [0, 1, 0]],
                    // Z-shape
                    [[1, 1, 0], [0, 1, 1]]
                ];
                
                this.init();
            }

            initSounds() {
                // Create audio context for sound effects
                this.audioContext = null;
                
                // Initialize audio context on first user interaction
                this.soundsEnabled = true;
                
                // Sound frequencies and settings
                this.sounds = {
                    drag: { frequency: 220, duration: 0.1, type: 'sine' },
                    drop: { frequency: 330, duration: 0.2, type: 'square' },
                    lineClear: { frequency: 440, duration: 0.5, type: 'sawtooth' },
                    success: { frequency: 523, duration: 0.3, type: 'sine' },
                    invalid: { frequency: 150, duration: 0.2, type: 'triangle' }
                };
            }

            initAudioContext() {
                if (!this.audioContext && this.soundsEnabled) {
                    try {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    } catch (error) {
                        console.log('Audio not supported');
                        this.soundsEnabled = false;
                    }
                }
            }

            playSound(soundType) {
                if (!this.soundsEnabled || !this.sounds[soundType]) return;
                
                this.initAudioContext();
                if (!this.audioContext) return;
                
                try {
                    const sound = this.sounds[soundType];
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.type = sound.type;
                    oscillator.frequency.setValueAtTime(sound.frequency, this.audioContext.currentTime);
                    
                    // Create envelope for better sound
                    gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.1, this.audioContext.currentTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + sound.duration);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + sound.duration);
                } catch (error) {
                    console.log('Error playing sound:', error);
                }
            }

            playLineClearSound() {
                if (!this.soundsEnabled) return;
                
                this.initAudioContext();
                if (!this.audioContext) return;
                
                try {
                    // Play a sequence of ascending notes for line clear
                    const frequencies = [262, 330, 392, 523]; // C, E, G, C (major chord)
                    
                    frequencies.forEach((freq, index) => {
                        setTimeout(() => {
                            const oscillator = this.audioContext.createOscillator();
                            const gainNode = this.audioContext.createGain();
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(this.audioContext.destination);
                            
                            oscillator.type = 'sine';
                            oscillator.frequency.setValueAtTime(freq, this.audioContext.currentTime);
                            
                            gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                            gainNode.gain.linearRampToValueAtTime(0.15, this.audioContext.currentTime + 0.01);
                            gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + 0.3);
                            
                            oscillator.start(this.audioContext.currentTime);
                            oscillator.stop(this.audioContext.currentTime + 0.3);
                        }, index * 100);
                    });
                } catch (error) {
                    console.log('Error playing line clear sound:', error);
                }
            }

            saveProgress() {
                const gameData = {
                    score: this.score,
                    currentLevel: this.currentLevel,
                    currentHijaiyahIndex: this.currentHijaiyahIndex,
                    lineClearCount: this.lineClearCount,
                    grid: this.grid,
                    gridLetters: this.gridLetters,
                    gridColors: this.gridColors,
                    currentPieces: this.currentPieces,
                    isInEvaluation: this.isInEvaluation,
                    lastSaved: new Date().toISOString()
                };
                
                try {
                    localStorage.setItem('blockBlastHijaiyahProgress', JSON.stringify(gameData));
                } catch (error) {
                    console.log('Gagal menyimpan progress:', error);
                }
            }

            loadProgress() {
                try {
                    const savedData = localStorage.getItem('blockBlastHijaiyahProgress');
                    if (savedData) {
                        const gameData = JSON.parse(savedData);
                        
                        this.score = gameData.score || 0;
                        this.currentLevel = gameData.currentLevel || 1;
                        this.currentHijaiyahIndex = gameData.currentHijaiyahIndex || 0;
                        this.lineClearCount = gameData.lineClearCount || 0;
                        this.isInEvaluation = gameData.isInEvaluation || false;
                        
                        if (gameData.grid) {
                            this.grid = gameData.grid;
                            this.gridLetters = gameData.gridLetters || Array(this.gridSize).fill().map(() => Array(this.gridSize).fill(''));
                            this.gridColors = gameData.gridColors || Array(this.gridSize).fill().map(() => Array(this.gridSize).fill(''));
                        }
                        
                        if (gameData.currentPieces) {
                            this.currentPieces = gameData.currentPieces;
                        }
                        
                        return true;
                    }
                } catch (error) {
                    console.log('Gagal memuat progress:', error);
                }
                return false;
            }

            clearProgress() {
                try {
                    localStorage.removeItem('blockBlastHijaiyahProgress');
                } catch (error) {
                    console.log('Gagal menghapus progress:', error);
                }
            }

            init() {
                this.createGrid();
                this.updateScore();
                this.updateLevel();
                
                const hasProgress = this.loadProgress();
                if (hasProgress) {
                    this.restoreGridVisual();
                    if (this.currentPieces && this.currentPieces.length > 0) {
                        this.renderPieces();
                    } else {
                        this.generateNewPieces();
                    }
                } else {
                    this.addStartingBlocks();
                    this.generateNewPieces();
                }
                
                this.setupEventListeners();
            }

            restoreGridVisual() {
                for (let r = 0; r < this.gridSize; r++) {
                    for (let c = 0; c < this.gridSize; c++) {
                        if (this.grid[r][c] === 1) {
                            const cell = document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                            const letter = this.gridLetters[r][c];
                            const color = this.gridColors[r][c];
                            
                            cell.classList.add('filled');
                            cell.style.setProperty('--cell-color', color);
                            cell.style.background = color;
                            cell.style.color = '#333';
                            cell.style.fontSize = 'clamp(8px, 2vw, 12px)';
                            cell.style.fontWeight = 'bold';
                            cell.style.display = 'flex';
                            cell.style.alignItems = 'center';
                            cell.style.justifyContent = 'center';
                            cell.style.opacity = '1';
                            cell.textContent = letter;
                        }
                    }
                }
            }

            addStartingBlocks(isReset = false) {
                const startingBlockCount = isReset ? 
                    Math.floor(Math.random() * 8) + 10 :
                    Math.floor(Math.random() * 12) + 15;
                
                for (let i = 0; i < startingBlockCount; i++) {
                    let row, col;
                    let attempts = 0;
                    
                    do {
                        row = Math.floor(Math.random() * this.gridSize);
                        col = Math.floor(Math.random() * this.gridSize);
                        attempts++;
                    } while (this.grid[row][col] === 1 && attempts < 50);
                    
                    if (attempts < 50) {
                        this.grid[row][col] = 1;
                        const randomLetter = this.arabicLetters[Math.floor(Math.random() * this.arabicLetters.length)];
                        const randomColor = this.blockColors[Math.floor(Math.random() * this.blockColors.length)];
                        
                        this.gridLetters[row][col] = randomLetter;
                        this.gridColors[row][col] = randomColor;
                        
                        const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                        cell.classList.add('filled');
                        cell.style.setProperty('--cell-color', randomColor);
                        cell.style.background = randomColor;
                        cell.style.color = '#333';
                        cell.style.fontSize = 'clamp(8px, 2vw, 12px)';
                        cell.style.fontWeight = 'bold';
                        cell.style.display = 'flex';
                        cell.style.alignItems = 'center';
                        cell.style.justifyContent = 'center';
                        cell.style.opacity = '1';
                        cell.textContent = randomLetter;
                    }
                }
            }

            createGrid() {
                const gridElement = document.getElementById('gameGrid');
                gridElement.innerHTML = '';
                
                for (let i = 0; i < this.gridSize * this.gridSize; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.dataset.row = Math.floor(i / this.gridSize);
                    cell.dataset.col = i % this.gridSize;
                    gridElement.appendChild(cell);
                }
            }

            generateNewPieces() {
                this.currentPieces = [];
                for (let i = 0; i < 3; i++) {
                    const randomShape = this.pieceShapes[Math.floor(Math.random() * this.pieceShapes.length)];
                    const randomLetter = this.arabicLetters[Math.floor(Math.random() * this.arabicLetters.length)];
                    const randomColor = this.blockColors[Math.floor(Math.random() * this.blockColors.length)];
                    
                    this.currentPieces.push({
                        shape: randomShape,
                        letter: randomLetter,
                        color: randomColor
                    });
                }
                this.renderPieces();
            }

            renderPieces() {
                const containers = document.querySelectorAll('.piece-holder');
                containers.forEach((container, index) => {
                    container.innerHTML = '';
                    container.classList.remove('selected', 'empty', 'dragging');
                    
                    if (this.currentPieces[index]) {
                        const piece = this.createPieceElement(this.currentPieces[index]);
                        container.appendChild(piece);
                        container.dataset.pieceIndex = index;
                    } else {
                        container.classList.add('empty');
                    }
                });
            }

            createPieceElement(pieceData) {
                const piece = document.createElement('div');
                piece.className = 'piece';
                piece.style.gridTemplateColumns = `repeat(${pieceData.shape[0].length}, 1fr)`;
                
                pieceData.shape.forEach(row => {
                    row.forEach(cell => {
                        const block = document.createElement('div');
                        if (cell === 1) {
                            block.className = 'piece-block';
                            block.style.setProperty('--block-color', pieceData.color);
                            block.style.background = pieceData.color;
                            block.style.color = '#333';
                            block.style.fontSize = 'clamp(8px, 2vw, 12px)';
                            block.style.fontWeight = 'bold';
                            block.style.display = 'flex';
                            block.style.alignItems = 'center';
                            block.style.justifyContent = 'center';
                            block.textContent = pieceData.letter;
                        } else {
                            block.style.width = 'clamp(18px, 4vw, 24px)';
                            block.style.height = 'clamp(18px, 4vw, 24px)';
                        }
                        piece.appendChild(block);
                    });
                });
                
                return piece;
            }

            setupEventListeners() {
                this.isDragging = false;
                this.touchStartPos = null;
                this.lastTouchTarget = null;

                // Touch events for piece holders
                document.querySelectorAll('.piece-holder').forEach((holder, index) => {
                    // Touch events
                    holder.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        if (this.currentPieces[index]) {
                            this.draggedPieceIndex = index;
                            this.isDragging = true;
                            holder.classList.add('dragging');
                            this.playSound('drag');
                            this.touchStartPos = {
                                x: e.touches[0].clientX,
                                y: e.touches[0].clientY
                            };
                        }
                    }, { passive: false });

                    holder.addEventListener('touchmove', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        if (this.isDragging) {
                            this.handleTouchMove(e);
                        }
                    }, { passive: false });

                    holder.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        if (this.isDragging) {
                            this.handleTouchEnd(e);
                        }
                    }, { passive: false });

                    // Mouse events for desktop/tablet compatibility
                    holder.addEventListener('mousedown', (e) => {
                        e.preventDefault();
                        if (this.currentPieces[index]) {
                            this.draggedPieceIndex = index;
                            this.isDragging = true;
                            holder.classList.add('dragging');
                            this.playSound('drag');
                        }
                    });

                    holder.addEventListener('mousemove', (e) => {
                        e.preventDefault();
                        if (this.isDragging) {
                            this.handleMouseMove(e);
                        }
                    });

                    holder.addEventListener('mouseup', (e) => {
                        e.preventDefault();
                        if (this.isDragging) {
                            this.handleMouseEnd(e);
                        }
                    });
                });

                // Global touch/mouse move events
                document.addEventListener('touchmove', (e) => {
                    if (this.isDragging) {
                        e.preventDefault();
                        this.handleTouchMove(e);
                    }
                }, { passive: false });

                document.addEventListener('touchend', (e) => {
                    if (this.isDragging) {
                        e.preventDefault();
                        this.handleTouchEnd(e);
                    }
                }, { passive: false });

                document.addEventListener('mousemove', (e) => {
                    if (this.isDragging) {
                        e.preventDefault();
                        this.handleMouseMove(e);
                    }
                });

                document.addEventListener('mouseup', (e) => {
                    if (this.isDragging) {
                        e.preventDefault();
                        this.handleMouseEnd(e);
                    }
                });

                // Grid cell events
                document.querySelectorAll('.grid-cell').forEach(cell => {
                    cell.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        if (this.isDragging && this.draggedPieceIndex !== undefined) {
                            const row = parseInt(cell.dataset.row);
                            const col = parseInt(cell.dataset.col);
                            this.showPreview(row, col);
                        }
                    }, { passive: false });

                    cell.addEventListener('mouseenter', (e) => {
                        if (this.isDragging && this.draggedPieceIndex !== undefined) {
                            const row = parseInt(cell.dataset.row);
                            const col = parseInt(cell.dataset.col);
                            this.showPreview(row, col);
                        }
                    });
                });
            }

            handleTouchMove(e) {
                if (!this.isDragging) return;
                
                const touch = e.touches[0];
                const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                
                if (elementBelow && elementBelow.classList.contains('grid-cell')) {
                    const row = parseInt(elementBelow.dataset.row);
                    const col = parseInt(elementBelow.dataset.col);
                    this.showPreview(row, col);
                }
            }

            handleTouchEnd(e) {
                if (!this.isDragging) return;
                
                const touch = e.changedTouches[0];
                const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
                
                if (elementBelow && elementBelow.classList.contains('grid-cell')) {
                    const row = parseInt(elementBelow.dataset.row);
                    const col = parseInt(elementBelow.dataset.col);
                    this.placePiece(row, col);
                }
                
                this.endDrag();
            }

            handleMouseMove(e) {
                if (!this.isDragging) return;
                
                const elementBelow = document.elementFromPoint(e.clientX, e.clientY);
                
                if (elementBelow && elementBelow.classList.contains('grid-cell')) {
                    const row = parseInt(elementBelow.dataset.row);
                    const col = parseInt(elementBelow.dataset.col);
                    this.showPreview(row, col);
                }
            }

            handleMouseEnd(e) {
                if (!this.isDragging) return;
                
                const elementBelow = document.elementFromPoint(e.clientX, e.clientY);
                
                if (elementBelow && elementBelow.classList.contains('grid-cell')) {
                    const row = parseInt(elementBelow.dataset.row);
                    const col = parseInt(elementBelow.dataset.col);
                    this.placePiece(row, col);
                }
                
                this.endDrag();
            }

            endDrag() {
                this.isDragging = false;
                this.draggedPieceIndex = undefined;
                this.clearPreview();
                
                document.querySelectorAll('.piece-holder').forEach(holder => {
                    holder.classList.remove('dragging');
                });
            }

            showPreview(row, col) {
                this.clearPreview();
                
                if (this.draggedPieceIndex === undefined) return;
                
                const pieceData = this.currentPieces[this.draggedPieceIndex];
                if (!pieceData) return;
                
                const canPlace = this.canPlacePiece(pieceData.shape, row, col);
                
                for (let r = 0; r < pieceData.shape.length; r++) {
                    for (let c = 0; c < pieceData.shape[r].length; c++) {
                        if (pieceData.shape[r][c] === 1) {
                            const newRow = row + r;
                            const newCol = col + c;
                            
                            if (newRow >= 0 && newRow < this.gridSize && newCol >= 0 && newCol < this.gridSize) {
                                const cell = document.querySelector(`[data-row="${newRow}"][data-col="${newCol}"]`);
                                if (cell) {
                                    cell.classList.add(canPlace ? 'preview' : 'invalid');
                                    if (canPlace) {
                                        cell.style.setProperty('--preview-color', `${pieceData.color}99`);
                                        cell.style.background = `${pieceData.color}99`;
                                    }
                                }
                            }
                        }
                    }
                }
            }

            clearPreview() {
                document.querySelectorAll('.grid-cell').forEach(cell => {
                    cell.classList.remove('preview', 'invalid');
                    if (!cell.classList.contains('filled')) {
                        cell.style.background = '';
                        cell.textContent = '';
                    }
                });
            }

            canPlacePiece(shape, startRow, startCol) {
                for (let r = 0; r < shape.length; r++) {
                    for (let c = 0; c < shape[r].length; c++) {
                        if (shape[r][c] === 1) {
                            const newRow = startRow + r;
                            const newCol = startCol + c;
                            
                            if (newRow < 0 || newRow >= this.gridSize || 
                                newCol < 0 || newCol >= this.gridSize || 
                                this.grid[newRow][newCol] === 1) {
                                return false;
                            }
                        }
                    }
                }
                return true;
            }

            placePiece(row, col) {
                const pieceData = this.currentPieces[this.draggedPieceIndex];
                
                if (!pieceData || !this.canPlacePiece(pieceData.shape, row, col)) {
                    this.playSound('invalid');
                    return;
                }

                this.playSound('drop');

                for (let r = 0; r < pieceData.shape.length; r++) {
                    for (let c = 0; c < pieceData.shape[r].length; c++) {
                        if (pieceData.shape[r][c] === 1) {
                            const newRow = row + r;
                            const newCol = col + c;
                            this.grid[newRow][newCol] = 1;
                            this.gridLetters[newRow][newCol] = pieceData.letter;
                            this.gridColors[newRow][newCol] = pieceData.color;
                            
                            const cell = document.querySelector(`[data-row="${newRow}"][data-col="${newCol}"]`);
                            cell.classList.add('filled');
                            cell.style.setProperty('--cell-color', pieceData.color);
                            cell.style.background = pieceData.color;
                            cell.style.color = '#333';
                            cell.style.fontSize = 'clamp(8px, 2vw, 12px)';
                            cell.style.fontWeight = 'bold';
                            cell.style.display = 'flex';
                            cell.style.alignItems = 'center';
                            cell.style.justifyContent = 'center';
                            cell.style.opacity = '1';
                            cell.textContent = pieceData.letter;
                        }
                    }
                }

                this.currentPieces[this.draggedPieceIndex] = null;
                this.renderPieces();
                this.clearPreview();

                this.checkLineClear();

                if (this.currentPieces.every(piece => piece === null)) {
                    this.generateNewPieces();
                }

                this.saveProgress();
                this.isGameOver();
            }

            checkLineClear() {
                const linesToClear = [];
                
                for (let r = 0; r < this.gridSize; r++) {
                    if (this.grid[r].every(cell => cell === 1)) {
                        linesToClear.push({type: 'row', index: r});
                    }
                }
                
                for (let c = 0; c < this.gridSize; c++) {
                    if (this.grid.every(row => row[c] === 1)) {
                        linesToClear.push({type: 'col', index: c});
                    }
                }

                if (linesToClear.length > 0) {
                    this.playLineClearSound();
                    this.showComboEffect(linesToClear.length);
                    this.createScreenFlash();
                    this.clearLines(linesToClear);
                    this.lineClearCount++;
                    
                    // Different popup frequency based on level
                    const popupFrequency = this.currentLevel === 1 ? 2 : 2; // Level 1: every 2, Level 2: every 2
                    
                    if (this.lineClearCount % popupFrequency === 0) {
                        setTimeout(() => {
                            this.showReadingPopup();
                        }, 1500);
                    }
                }
            }

            showComboEffect(lineCount) {
                const comboTexts = {
                    1: '‚ú® Alhamdulillah! ‚ú®',
                    2: 'üî• Maasyaa Allah! üî•',
                    3: '‚ö° SUPER Maasyaa Allah! ‚ö°',
                    4: 'üí• MEGA Maasyaa Allah! üí•',
                    5: 'üåü ULTRA Maasyaa Allah! üåü'
                };
                
                const comboText = comboTexts[Math.min(lineCount, 5)] || 'üéÜ Subhanallah! üéÜ';
                
                const comboElement = document.createElement('div');
                comboElement.className = 'combo-effect';
                comboElement.textContent = comboText;
                document.body.appendChild(comboElement);
                
                setTimeout(() => {
                    if (comboElement.parentNode) {
                        comboElement.parentNode.removeChild(comboElement);
                    }
                }, 2000);
            }

            createScreenFlash() {
                const flashElement = document.createElement('div');
                flashElement.className = 'screen-flash';
                document.body.appendChild(flashElement);
                
                setTimeout(() => {
                    if (flashElement.parentNode) {
                        flashElement.parentNode.removeChild(flashElement);
                    }
                }, 800);
            }

            createParticleEffect(cell) {
                const rect = cell.getBoundingClientRect();
                const particleCount = 6;
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle-effect';
                    
                    const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#9B59B6', '#E67E22'];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.background = color;
                    particle.style.color = color;
                    
                    particle.style.left = (rect.left + rect.width / 2) + 'px';
                    particle.style.top = (rect.top + rect.height / 2) + 'px';
                    
                    const angle = (i / particleCount) * 2 * Math.PI + Math.random() * 0.5;
                    const distance = 40 + Math.random() * 40;
                    const endX = Math.cos(angle) * distance;
                    const endY = Math.sin(angle) * distance - 20; // Add upward bias
                    
                    particle.style.setProperty('--particle-x', endX + 'px');
                    particle.style.setProperty('--particle-y', endY + 'px');
                    
                    document.body.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 1500);
                }
            }

            clearLines(lines) {
                const cellsToClear = new Set();
                
                lines.forEach(line => {
                    if (line.type === 'row') {
                        for (let c = 0; c < this.gridSize; c++) {
                            cellsToClear.add(`${line.index}-${c}`);
                        }
                    } else {
                        for (let r = 0; r < this.gridSize; r++) {
                            cellsToClear.add(`${r}-${line.index}`);
                        }
                    }
                });

                // Add line clear text effect
                const gameGrid = document.getElementById('gameGrid');
                const lineText = document.createElement('div');
                lineText.className = 'line-clear-text';
                lineText.textContent = lines.length === 1 ? 'LINE CLEAR!' : `${lines.length} LINES!`;
                gameGrid.style.position = 'relative';
                gameGrid.appendChild(lineText);
                
                setTimeout(() => {
                    if (lineText.parentNode) {
                        lineText.parentNode.removeChild(lineText);
                    }
                }, 1200);

                cellsToClear.forEach(cellKey => {
                    const [r, c] = cellKey.split('-').map(Number);
                    const cell = document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                    cell.classList.add('clear-animation');
                    
                    // Create particle effect for each cleared cell
                    setTimeout(() => {
                        this.createParticleEffect(cell);
                    }, 300 + Math.random() * 200);
                });

                setTimeout(() => {
                    cellsToClear.forEach(cellKey => {
                        const [r, c] = cellKey.split('-').map(Number);
                        this.grid[r][c] = 0;
                        this.gridLetters[r][c] = '';
                        this.gridColors[r][c] = '';
                        const cell = document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                        cell.classList.remove('filled', 'clear-animation');
                        cell.style.background = '';
                        cell.style.color = '';
                        cell.style.fontSize = '';
                        cell.style.fontWeight = '';
                        cell.style.display = '';
                        cell.style.alignItems = '';
                        cell.style.justifyContent = '';
                        cell.textContent = '';
                    });
                    
                    this.score += cellsToClear.size * 10 * lines.length; // Bonus for multiple lines
                    this.updateScore();
                    this.checkLineClear();
                }, 1200);
            }

            isGameOver() {
                const hasValidMove = this.currentPieces.some(pieceData => {
                    if (!pieceData) return false;
                    
                    for (let r = 0; r < this.gridSize; r++) {
                        for (let c = 0; c < this.gridSize; c++) {
                            if (this.canPlacePiece(pieceData.shape, r, c)) {
                                return true;
                            }
                        }
                    }
                    return false;
                });
                
                if (!hasValidMove) {
                    this.showEncouragementReset();
                    return false;
                }
                return false;
            }

            showEncouragementReset() {
                const learnedCount = this.currentHijaiyahIndex;
                const totalLetters = this.hijaiyahSequence.length;
                
                let message = "üåü Ayo Coba Lagi! üåü\n\n";
                if (learnedCount > 0) {
                    message += `Kamu sudah hebat belajar ${learnedCount} huruf Hijaiyah berharakat Fathah!\n`;
                    message += `Tinggal ${totalLetters - learnedCount} huruf lagi untuk menyelesaikan Level 1.\n\n`;
                } else {
                    message += "Semangat! Mari kita mulai belajar huruf Hijaiyah berharakat Fathah bersama!\n\n";
                }
                message += "Grid akan direset agar kamu bisa melanjutkan belajar! üìö";
                
                alert(message);
                this.resetBoardKeepProgress();
            }

            resetBoardKeepProgress() {
                this.grid = Array(this.gridSize).fill().map(() => Array(this.gridSize).fill(0));
                this.gridLetters = Array(this.gridSize).fill().map(() => Array(this.gridSize).fill(''));
                this.gridColors = Array(this.gridSize).fill().map(() => Array(this.gridSize).fill(''));
                
                document.querySelectorAll('.grid-cell').forEach(cell => {
                    cell.classList.remove('filled');
                    cell.style.background = '';
                    cell.style.color = '';
                    cell.style.fontSize = '';
                    cell.style.fontWeight = '';
                    cell.style.display = '';
                    cell.style.alignItems = '';
                    cell.style.justifyContent = '';
                    cell.textContent = '';
                });
                
                this.addStartingBlocks(true);
                this.generateNewPieces();
            }

            updateScore() {
                document.getElementById('score').textContent = this.score;
            }

            updateLevel() {
                document.getElementById('currentLevel').textContent = this.currentLevel;
            }

            showReadingPopup() {
                const currentHijaiyah = this.hijaiyahSequence[this.currentHijaiyahIndex];
                document.getElementById('currentLetter').textContent = currentHijaiyah.letter;
                document.getElementById('readingPopup').style.display = 'flex';
                this.playSound('success');
            }

            continueReading() {
                document.getElementById('readingPopup').style.display = 'none';
                this.currentHijaiyahIndex++;
                this.saveProgress();
                
                // Check if it's time for evaluation (every 5 letters)
                if (this.currentHijaiyahIndex % 5 === 0 && this.currentHijaiyahIndex > 0) {
                    setTimeout(() => {
                        const learnedLetters = this.hijaiyahSequence.slice(this.currentHijaiyahIndex - 5, this.currentHijaiyahIndex);
                        const lettersList = learnedLetters.map(l => l.letter).join(' ');
                        alert(`üéâ Alhamdulillah!\n\nAnda telah mempelajari 5 huruf Hijaiyah berharakat Fathah:\n\nüìö ${lettersList}\n\nSekarang saatnya evaluasi untuk menguji pemahaman Anda!\n\nüìù 10 soal menanti...`);
                        this.startEvaluation();
                    }, 500);
                } else if (this.currentHijaiyahIndex >= this.hijaiyahSequence.length) {
                    // All letters completed
                    setTimeout(() => {
                        alert('üéâ Subhanallah! Anda telah menyelesaikan semua 28 huruf Hijaiyah berharakat Fathah!\n\nüìù Sekarang saatnya Evaluasi Final Level 1:\n‚Ä¢ 50 soal kombinasi huruf\n‚Ä¢ 25 soal: 2 huruf terpisah\n‚Ä¢ 25 soal: 3 huruf terpisah\n\nSemua huruf berharakat Fathah dan tidak bersambung.\n\nSiap untuk ujian akhir? üèÜ');
                        this.startEvaluation();
                    }, 500);
                } else {
                    this.resetBoard();
                    this.saveProgress();
                }
            }

            resetBoard() {
                this.grid = Array(this.gridSize).fill().map(() => Array(this.gridSize).fill(0));
                this.gridLetters = Array(this.gridSize).fill().map(() => Array(this.gridSize).fill(''));
                this.gridColors = Array(this.gridSize).fill().map(() => Array(this.gridSize).fill(''));
                
                document.querySelectorAll('.grid-cell').forEach(cell => {
                    cell.classList.remove('filled');
                    cell.style.background = '';
                    cell.style.color = '';
                    cell.style.fontSize = '';
                    cell.style.fontWeight = '';
                    cell.style.display = '';
                    cell.style.alignItems = '';
                    cell.style.justifyContent = '';
                    cell.textContent = '';
                });
                
                this.addStartingBlocks();
                this.generateNewPieces();
                this.saveProgress();
            }

            startEvaluation() {
                this.isInEvaluation = true;
                this.evaluationScore = 0;
                this.currentQuestionIndex = 0;
                this.generateEvaluationQuestions();
                this.showEvaluationQuestion();
                this.saveProgress();
            }

            generateEvaluationQuestions() {
                this.evaluationQuestions = [];
                
                // Check if this is the final evaluation (all 28 letters completed)
                if (this.currentHijaiyahIndex >= this.hijaiyahSequence.length) {
                    // Final evaluation: 30 questions with 2-letter and 3-letter combinations
                    this.generateFinalEvaluation();
                } else {
                    // Regular evaluation: focus on last 5 learned letters only
                    const startIndex = Math.max(0, this.currentHijaiyahIndex - 5);
                    const recentLetters = this.hijaiyahSequence.slice(startIndex, this.currentHijaiyahIndex);
                    
                    // Create 10 reading questions from recent 5 letters only
                    // Each letter should appear at least once, then fill remaining with random
                    const questionsPerLetter = Math.floor(10 / recentLetters.length);
                    const extraQuestions = 10 % recentLetters.length;
                    
                    // Add questions for each letter
                    recentLetters.forEach((letter, index) => {
                        // Add base questions for each letter
                        for (let i = 0; i < questionsPerLetter; i++) {
                            this.evaluationQuestions.push({
                                letter: letter.letter,
                                name: letter.name,
                                instruction: `Bacalah huruf berikut:`,
                                type: 'single'
                            });
                        }
                        
                        // Add extra questions for first few letters
                        if (index < extraQuestions) {
                            this.evaluationQuestions.push({
                                letter: letter.letter,
                                name: letter.name,
                                instruction: `Bacalah huruf berikut:`,
                                type: 'single'
                            });
                        }
                    });
                    
                    // Ensure we have exactly 10 questions
                    while (this.evaluationQuestions.length < 10) {
                        const randomLetter = recentLetters[Math.floor(Math.random() * recentLetters.length)];
                        this.evaluationQuestions.push({
                            letter: randomLetter.letter,
                            name: randomLetter.name,
                            instruction: `Bacalah huruf berikut:`,
                            type: 'single'
                        });
                    }
                }
                
                // Shuffle all questions for randomization
                this.evaluationQuestions = this.shuffleArray(this.evaluationQuestions);
                console.log('Generated evaluation questions:', this.evaluationQuestions.length);
            }

            generateFinalEvaluation() {
                // All 28 letters for combinations
                const allLetters = this.hijaiyahSequence.map(h => h.letter);
                
                // Generate 15 two-letter combinations
                for (let i = 0; i < 15; i++) {
                    const letter1 = allLetters[Math.floor(Math.random() * allLetters.length)];
                    const letter2 = allLetters[Math.floor(Math.random() * allLetters.length)];
                    const combination = letter1 + letter2;
                    
                    this.evaluationQuestions.push({
                        letter: combination,
                        name: `${this.getLetterName(letter1)} ${this.getLetterName(letter2)}`,
                        instruction: `Bacalah kombinasi 2 huruf berikut:`,
                        type: 'combination'
                    });
                }
                
                // Generate 15 three-letter combinations
                for (let i = 0; i < 15; i++) {
                    const letter1 = allLetters[Math.floor(Math.random() * allLetters.length)];
                    const letter2 = allLetters[Math.floor(Math.random() * allLetters.length)];
                    const letter3 = allLetters[Math.floor(Math.random() * allLetters.length)];
                    const combination = letter1 + letter2 + letter3;
                    
                    this.evaluationQuestions.push({
                        letter: combination,
                        name: `${this.getLetterName(letter1)} ${this.getLetterName(letter2)} ${this.getLetterName(letter3)}`,
                        instruction: `Bacalah kombinasi 3 huruf berikut:`,
                        type: 'combination'
                    });
                }
            }

            getLetterName(letter) {
                const found = this.hijaiyahSequence.find(h => h.letter === letter);
                return found ? found.name : letter;
            }

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            showEvaluationQuestion() {
                const question = this.evaluationQuestions[this.currentQuestionIndex];
                const totalQuestions = this.evaluationQuestions.length;
                
                console.log(`Showing question ${this.currentQuestionIndex + 1}: ${question.letter}`);
                
                // Clear previous content and reset all elements
                const resultElement = document.getElementById('evaluationResult');
                if (resultElement) {
                    resultElement.textContent = '';
                }
                
                // Update question number and progress
                const questionNumberElement = document.getElementById('questionNumber');
                if (questionNumberElement) {
                    questionNumberElement.textContent = this.currentQuestionIndex + 1;
                }
                
                // Update progress display
                const progressElement = document.querySelector('.evaluation-progress');
                if (progressElement) {
                    progressElement.innerHTML = `Soal <span id="questionNumber">${this.currentQuestionIndex + 1}</span> dari ${totalQuestions}`;
                }
                
                // Update the instruction text
                const instructionElement = document.querySelector('.evaluation-content p');
                if (instructionElement) {
                    instructionElement.textContent = question.instruction || 'Bacalah huruf berikut:';
                }
                
                // Update the letter display - FORCE UPDATE
                const lettersElement = document.getElementById('evaluationLetters');
                if (lettersElement) {
                    // Clear and force refresh
                    lettersElement.innerHTML = '';
                    lettersElement.textContent = question.letter;
                    
                    // Adjust letter display size based on type
                    if (question.type === 'combination') {
                        lettersElement.style.fontSize = question.letter.length === 2 ? '2.8rem' : '2.2rem';
                        lettersElement.style.letterSpacing = '0.2em';
                    } else {
                        lettersElement.style.fontSize = '3.5rem';
                        lettersElement.style.letterSpacing = 'normal';
                    }
                    
                    // Force DOM update
                    lettersElement.offsetHeight;
                }
                
                // Completely recreate the options container
                const optionsContainer = document.getElementById('evaluationOptions');
                if (optionsContainer) {
                    optionsContainer.innerHTML = '';
                    
                    // Create single "Sudah Dibaca" button
                    const readButton = document.createElement('button');
                    readButton.className = 'option-btn';
                    readButton.style.gridColumn = '1 / -1'; // Span full width
                    readButton.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
                    readButton.style.fontSize = '1.2rem';
                    readButton.style.padding = '20px';
                    readButton.textContent = '‚úÖ Sudah Dibaca';
                    readButton.disabled = false;
                    
                    // Use arrow function to preserve context
                    readButton.addEventListener('click', () => {
                        this.confirmReading(question);
                    });
                    
                    optionsContainer.appendChild(readButton);
                }
                
                // Ensure popup is visible
                const popup = document.getElementById('evaluationPopup');
                if (popup) {
                    popup.style.display = 'flex';
                }
                
                console.log(`Question displayed: "${question.letter}" (${this.currentQuestionIndex + 1}/${totalQuestions})`);
            }

            confirmReading(question) {
                const button = document.querySelector('.option-btn');
                button.disabled = true;
                button.classList.add('correct');
                
                this.evaluationScore++;
                this.playSound('success');
                document.getElementById('evaluationResult').textContent = `‚úÖ Bagus! "${question.letter}" dibaca "${question.name}"`;
                
                setTimeout(() => {
                    this.currentQuestionIndex++;
                    console.log(`Moving to question ${this.currentQuestionIndex + 1} of ${this.evaluationQuestions.length}`);
                    
                    if (this.currentQuestionIndex < this.evaluationQuestions.length) {
                        this.showEvaluationQuestion();
                    } else {
                        console.log('All questions completed, showing results');
                        this.showEvaluationResult();
                    }
                }, 1500);
            }

            showEvaluationResult() {
                document.getElementById('evaluationPopup').style.display = 'none';
                
                // Check if this is the final evaluation (all 28 letters completed)
                if (this.currentHijaiyahIndex >= this.hijaiyahSequence.length) {
                    // Final evaluation with 30 questions
                    document.getElementById('evaluationScore').textContent = `${this.evaluationScore}/30`;
                    
                    // Update level complete message for final evaluation
                    const levelCompleteContent = document.querySelector('.level-complete-content');
                    if (levelCompleteContent) {
                        levelCompleteContent.innerHTML = `
                            <h2>üéâ Selamat!</h2>
                            <p>Anda telah menyelesaikan <strong>Level 1</strong>!</p>
                            <div style="margin: 20px 0;">
                                <p><strong>üìä Hasil Evaluasi Final:</strong></p>
                                <p>Skor: <span id="finalEvaluationScore">${this.evaluationScore}/30</span></p>
                                <p>‚Ä¢ 15 soal kombinasi 2 huruf</p>
                                <p>‚Ä¢ 15 soal kombinasi 3 huruf</p>
                            </div>
                            <p><strong>üèÜ Semua 28 huruf Hijaiyah berharakat Fathah telah dikuasai!</strong></p>
                            <p>Siap untuk melanjutkan ke Level 2?</p>
                            <button class="continue-btn" onclick="completeLevel1()">Kembali ke Peta Level</button>
                        `;
                    }
                    
                    document.getElementById('levelComplete').style.display = 'flex';
                } else {
                    // Regular evaluation - show progress and continue
                    const remainingLetters = this.hijaiyahSequence.length - this.currentHijaiyahIndex;
                    const startIndex = Math.max(0, this.currentHijaiyahIndex - 5);
                    const evaluatedLetters = this.hijaiyahSequence.slice(startIndex, this.currentHijaiyahIndex);
                    const lettersList = evaluatedLetters.map(l => l.letter).join(' ');
                    
                    setTimeout(() => {
                        alert(`üéâ Evaluasi Selesai!\n\n‚úÖ Skor: ${this.evaluationScore}/10\nüìö Huruf yang dievaluasi (5 huruf terakhir):\n${lettersList}\n\nüìä Progress: ${this.currentHijaiyahIndex}/${this.hijaiyahSequence.length} huruf\n\nüöÄ Mari lanjutkan belajar ${remainingLetters} huruf berikutnya!\n\nBersihkan 2 baris lagi untuk huruf selanjutnya!\n\nüìù Evaluasi berikutnya setelah 5 huruf lagi!`);
                        this.isInEvaluation = false;
                        this.resetBoard();
                        this.saveProgress();
                    }, 500);
                }
            }

            completeLevel() {
                this.currentLevel = 2;
                this.isInEvaluation = false;
                this.saveProgress();
            }
        }

        let game;
        let selectedLevel = 1;

        function startGame() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('levelMapScreen').style.display = 'flex';
            
            if (!game) {
                game = new BlockBlastGame();
            }
            
            updateLevelMap();
        }

        function updateLevelMap() {
            const savedData = localStorage.getItem('blockBlastHijaiyahProgress');
            let currentHijaiyahIndex = 0;
            let currentLevel = 1;
            let score = 0;
            
            if (savedData && game) {
                const gameData = JSON.parse(savedData);
                currentHijaiyahIndex = gameData.currentHijaiyahIndex || 0;
                currentLevel = gameData.currentLevel || 1;
                score = gameData.score || 0;
            }
            
            document.getElementById('level1Progress').textContent = `${currentHijaiyahIndex}/28`;
            document.getElementById('totalScore').textContent = score.toLocaleString();
            document.getElementById('totalLetters').textContent = `${currentHijaiyahIndex}/28`;
            document.getElementById('activeLevel').textContent = currentLevel;
            
            const level1Node = document.querySelector('.level-1');
            const level1Status = document.getElementById('level1Status');
            
            if (currentHijaiyahIndex >= 28) {
                level1Node.classList.remove('available');
                level1Node.classList.add('completed');
                level1Status.classList.remove('locked');
                level1Status.classList.add('completed');
                level1Status.innerHTML = '<span>‚≠ê</span>';
                
                const level2Node = document.getElementById('level2Node');
                const level2Status = document.getElementById('level2Status');
                const connector1 = document.getElementById('connector1');
                
                level2Node.classList.remove('locked');
                level2Node.classList.add('available');
                level2Status.classList.remove('locked');
                level2Status.innerHTML = '<span>‚ñ∂Ô∏è</span>';
                connector1.classList.remove('locked');
            } else {
                level1Node.classList.add('available');
                level1Node.classList.remove('locked', 'completed');
                level1Status.classList.remove('locked', 'completed');
                level1Status.innerHTML = '<span>‚ñ∂Ô∏è</span>';
            }
            
            if (currentLevel === 1 || currentHijaiyahIndex < 28) {
                selectLevel(1);
            } else {
                selectLevel(2);
            }
        }

        function handleLevelClick(levelNumber) {
            console.log('handleLevelClick called with:', levelNumber);
            
            const levelNode = document.querySelector(`.level-${levelNumber}`);
            console.log('Level node found:', levelNode);
            console.log('Level node classes:', levelNode ? levelNode.className : 'null');
            
            // Check if level is locked
            if (levelNode && levelNode.classList.contains('locked')) {
                console.log('Level is locked, showing password prompt');
                showPasswordPrompt(levelNumber);
                return;
            }
            
            // If level is available, start it directly
            selectedLevel = levelNumber;
            startSelectedLevel();
        }

        function selectLevel(levelNumber) {
            console.log('selectLevel called with:', levelNumber);
            
            const levelNode = document.querySelector(`.level-${levelNumber}`);
            console.log('Level node found:', levelNode);
            console.log('Level node classes:', levelNode ? levelNode.className : 'null');
            
            // Check if level is locked
            if (levelNode && levelNode.classList.contains('locked')) {
                console.log('Level is locked, showing password prompt');
                showPasswordPrompt(levelNumber);
                return;
            }
            
            selectedLevel = levelNumber;
            
            // Update button text
            const startBtn = document.getElementById('startSelectedLevel');
            if (startBtn) {
                startBtn.innerHTML = `<span class="btn-icon">üöÄ</span> Mulai Level ${levelNumber}`;
                startBtn.disabled = false;
            }
            
            // Remove previous selection
            document.querySelectorAll('.level-node').forEach(node => {
                node.classList.remove('selected');
            });
            
            // Add selection to current level
            if (levelNode) {
                levelNode.classList.add('selected');
            }
        }

        function showPasswordPrompt(levelNumber) {
            console.log('showPasswordPrompt called for level:', levelNumber);
            
            const levelPasswords = {
                2: 'hijaiyah2',
                3: 'hijaiyah3', 
                4: 'hijaiyah4',
                5: 'hijaiyah5'
            };
            
            try {
                // Show confirmation dialog
                const userChoice = confirm(`üîí Level ${levelNumber} masih terkunci!\n\n‚úÖ Selesaikan level sebelumnya untuk membuka secara normal\nüîë Atau gunakan password untuk membuka sekarang\n\nApakah Anda ingin memasukkan password?`);
                console.log('User choice:', userChoice);
                
                if (userChoice) {
                    // Show password input
                    const password = prompt(`üîë Masukkan password untuk Level ${levelNumber}:\n\nüí° Hint: hijaiyah + nomor level\n\nContoh: hijaiyah2`);
                    console.log('Password entered:', password ? 'yes' : 'no');
                    
                    if (password && password.trim() === levelPasswords[levelNumber]) {
                        console.log('Password correct, unlocking level');
                        // Unlock the level temporarily
                        unlockLevelTemporarily(levelNumber);
                        alert(`üéâ Password benar!\n\nLevel ${levelNumber} berhasil dibuka sementara.\n\n‚ö†Ô∏è Catatan: Level akan terkunci lagi saat refresh halaman kecuali Anda menyelesaikan level sebelumnya.`);
                        
                        // Auto-start the unlocked level
                        selectedLevel = levelNumber;
                        startSelectedLevel();
                    } else if (password !== null && password !== '') { // User didn't cancel and entered something
                        console.log('Password incorrect');
                        alert(`‚ùå Password salah!\n\nPassword yang benar: ${levelPasswords[levelNumber]}\n\nSilakan coba lagi atau selesaikan level sebelumnya terlebih dahulu.`);
                    }
                }
            } catch (error) {
                console.error('Error in showPasswordPrompt:', error);
                alert('Terjadi kesalahan. Silakan coba lagi.');
            }
        }

        function unlockLevelTemporarily(levelNumber) {
            const levelNode = document.querySelector(`.level-${levelNumber}`);
            const levelStatus = document.getElementById(`level${levelNumber}Status`);
            const connector = document.getElementById(`connector${levelNumber - 1}`);
            
            if (levelNode) {
                levelNode.classList.remove('locked');
                levelNode.classList.add('available');
                levelNode.style.border = '3px solid #FFD700';
                levelNode.style.boxShadow = '0 0 20px rgba(255, 215, 0, 0.5)';
                
                // Remove existing temp indicator if any
                const existingIndicator = levelNode.querySelector('.temp-unlock-indicator');
                if (existingIndicator) {
                    existingIndicator.remove();
                }
                
                // Add temporary unlock indicator
                const tempIndicator = document.createElement('div');
                tempIndicator.className = 'temp-unlock-indicator';
                tempIndicator.style.cssText = `
                    position: absolute;
                    top: -5px;
                    right: -5px;
                    background: linear-gradient(45deg, #FFD700, #FFA500);
                    color: #333;
                    padding: 4px 8px;
                    border-radius: 10px;
                    font-size: 0.7rem;
                    font-weight: bold;
                    z-index: 10;
                    animation: tempUnlockPulse 2s ease-in-out infinite;
                `;
                tempIndicator.textContent = 'üîë TEMP';
                levelNode.style.position = 'relative';
                levelNode.appendChild(tempIndicator);
            }
            
            if (levelStatus) {
                levelStatus.classList.remove('locked');
                levelStatus.innerHTML = '<span>üîë</span>';
            }
            
            if (connector) {
                connector.classList.remove('locked');
                connector.style.background = 'linear-gradient(to bottom, rgba(255, 215, 0, 0.6), rgba(255, 215, 0, 0.3))';
            }
        }

        function startSelectedLevel() {
            if (selectedLevel === 1 || selectedLevel === 2) {
                document.getElementById('levelMapScreen').style.display = 'none';
                document.getElementById('gameContainer').style.display = 'block';
                
                if (!game) {
                    game = new BlockBlastGame();
                    game.currentLevel = selectedLevel;
                } else {
                    game.currentLevel = selectedLevel;
                    game.updateScore();
                    game.updateLevel();
                    game.restoreGridVisual();
                    if (game.currentPieces && game.currentPieces.length > 0) {
                        game.renderPieces();
                    } else {
                        game.generateNewPieces();
                    }
                }
                
                const savedData = localStorage.getItem('blockBlastHijaiyahProgress');
                if (selectedLevel === 1) {
                    if (savedData) {
                        const gameData = JSON.parse(savedData);
                        const learnedLetters = gameData.currentHijaiyahIndex || 0;
                        if (learnedLetters > 0) {
                            setTimeout(() => {
                                const currentLetter = game.hijaiyahSequence[Math.min(learnedLetters - 1, game.hijaiyahSequence.length - 1)];
                                alert(`üéâ Selamat datang kembali!\n\nProgress Level 1:\n‚úÖ Sudah belajar ${learnedLetters} huruf Hijaiyah\nüìö Huruf terakhir: ${currentLetter.letter} (${currentLetter.name})\nüìä Skor: ${gameData.score || 0}\nüéØ Bersihkan 2 baris lagi untuk huruf berikutnya!\n\nMari lanjutkan belajar! üìö`);
                            }, 500);
                        } else {
                            setTimeout(() => {
                                alert(`üåü Selamat datang di Level 1!\n\nüìö Belajar 28 Huruf Hijaiyah Berharakat Fathah\nüéØ Cara bermain:\n‚Ä¢ Susun blok untuk mengisi baris/kolom\n‚Ä¢ Setiap 2 baris terhapus = belajar 1 huruf baru\n‚Ä¢ Mulai dari ÿ£Ÿé (Alif Fathah) sampai ŸäŸé (Ya Fathah)\n‚Ä¢ Setiap 5 huruf = evaluasi 10 soal bacaan\n\nAyo mulai belajar! üöÄ`);
                            }, 500);
                        }
                    }
                } else if (selectedLevel === 2) {
                    setTimeout(() => {
                        alert(`üéØ Selamat datang di Level 2!\n\nüìö Belajar Huruf Hijaiyah dengan Harakat\nüéØ Cara bermain:\n‚Ä¢ Susun blok untuk mengisi baris/kolom\n‚Ä¢ Setiap 2 baris terhapus = belajar 1 huruf baru\n‚Ä¢ Huruf dengan tanda baca (harakat)\n\nLevel ini lebih menantang! üöÄ`);
                    }, 500);
                }
            } else {
                alert(`üöß Level ${selectedLevel} sedang dalam pengembangan!\n\nUntuk saat ini, silakan selesaikan level sebelumnya terlebih dahulu.\n\n‚ú® Fitur baru akan segera hadir!`);
            }
        }

        function backToWelcomeFromMap() {
            document.getElementById('levelMapScreen').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'flex';
        }

        function showInstructions() {
            document.getElementById('instructionsModal').style.display = 'flex';
        }

        function closeInstructions() {
            document.getElementById('instructionsModal').style.display = 'none';
        }

        function backToLevelMap() {
            if (game) {
                game.saveProgress();
            }
            
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('levelMapScreen').style.display = 'flex';
            
            document.getElementById('readingPopup').style.display = 'none';
            document.getElementById('evaluationPopup').style.display = 'none';
            document.getElementById('levelComplete').style.display = 'none';
            
            updateLevelMap();
        }

        function continueReading() {
            game.continueReading();
        }

        function completeLevel1() {
            document.getElementById('levelComplete').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('levelMapScreen').style.display = 'flex';
            
            game.currentLevel = 2;
            game.isInEvaluation = false;
            game.saveProgress();
            
            setTimeout(() => {
                updateLevelMap();
                const percentage = Math.round((game.evaluationScore / 50) * 100);
                let gradeMsg = '';
                if (percentage >= 90) gradeMsg = 'A+ (Istimewa!)';
                else if (percentage >= 80) gradeMsg = 'A (Sangat Baik!)';
                else if (percentage >= 70) gradeMsg = 'B+ (Baik!)';
                else if (percentage >= 60) gradeMsg = 'B (Cukup Baik)';
                else gradeMsg = 'C (Perlu Latihan Lagi)';
                
                alert(`üéâ Alhamdulillah! Level 1 selesai!\n\n‚úÖ 28 huruf Hijaiyah berharakat Fathah telah dipelajari\nüìä Skor evaluasi final: ${game.evaluationScore}/50 (${percentage}%)\nüèÜ Grade: ${gradeMsg}\n\nüöß Level 2 akan segera hadir!\nUntuk saat ini, Anda bisa mengulang Level 1 atau mengeksplorasi fitur lainnya.`);
            }, 500);
        }

        function resetProgress() {
            if (confirm('‚ö†Ô∏è Apakah Anda yakin ingin menghapus semua progress?\n\nSemua huruf yang sudah dipelajari dan skor akan hilang!')) {
                if (game) {
                    game.clearProgress();
                }
                localStorage.removeItem('blockBlastHijaiyahProgress');
                document.getElementById('resetBtn').style.display = 'none';
                alert('‚úÖ Progress berhasil dihapus!\nAnda bisa memulai dari awal lagi.');
            }
        }

        window.addEventListener('load', function() {
            const savedData = localStorage.getItem('blockBlastHijaiyahProgress');
            if (savedData) {
                try {
                    const gameData = JSON.parse(savedData);
                    if (gameData.currentHijaiyahIndex > 0 || gameData.score > 0) {
                        document.getElementById('resetBtn').style.display = 'flex';
                    }
                } catch (error) {
                    console.log('Error checking saved data');
                }
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9717b6bc87c3f894',t:'MTc1NTU4NjE5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
I      
